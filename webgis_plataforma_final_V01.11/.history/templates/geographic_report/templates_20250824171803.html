{% extends 'layout.html' %}
{% block title %}Construtor de Templates - {{ company.name }}{% endblock %}

{% block content %}
<!-- Construtor Visual de Templates - Estilo Wix.com -->
<div id="template-builder" class="template-builder-container">
    <!-- Barra de Ferramentas Superior -->
    <div class="builder-toolbar">
        <div class="toolbar-left">
            <button class="btn btn-outline-secondary btn-sm" onclick="toggleLeftPanel()">
                <i class="fas fa-th-large"></i>
            </button>
            <button class="btn btn-outline-secondary btn-sm" onclick="toggleRightPanel()">
                <i class="fas fa-cog"></i>
            </button>
            <div class="separator"></div>
            <button class="btn btn-outline-primary btn-sm" onclick="undoAction()">
                <i class="fas fa-undo"></i>
            </button>
            <button class="btn btn-outline-primary btn-sm" onclick="redoAction()">
                <i class="fas fa-redo"></i>
            </button>
        </div>
        
        <div class="toolbar-center">
            <div class="view-controls">
                <button class="btn btn-sm active" data-view="desktop">
                    <i class="fas fa-desktop"></i>
                </button>
                <button class="btn btn-sm" data-view="tablet">
                    <i class="fas fa-tablet-alt"></i>
                </button>
                <button class="btn btn-sm" data-view="mobile">
                    <i class="fas fa-mobile-alt"></i>
                </button>
            </div>
        </div>
        
        <div class="toolbar-right">
            <button class="btn btn-outline-success btn-sm" onclick="previewTemplate()">
                <i class="fas fa-eye"></i> Preview
            </button>
            <button class="btn btn-success btn-sm" onclick="saveTemplate()">
                <i class="fas fa-save"></i> Salvar
            </button>
            <button class="btn btn-primary btn-sm" onclick="publishTemplate()">
                <i class="fas fa-rocket"></i> Publicar
            </button>
        </div>
    </div>

    <!-- Painel Esquerdo - Elementos -->
    <div class="left-panel" id="left-panel">
        <div class="panel-header">
            <h6><i class="fas fa-puzzle-piece"></i> Elementos</h6>
            <button class="btn-close btn-close-sm" onclick="toggleLeftPanel()"></button>
        </div>
        
        <div class="panel-content">
            <!-- Categorias de Elementos -->
            <div class="element-categories">
                <div class="category-section">
                    <h6 class="category-title">üì± B√°sicos</h6>
                    <div class="element-grid">
                        <div class="element-item" draggable="true" data-element="text">
                            <i class="fas fa-font"></i>
                            <span>Texto</span>
                        </div>
                        <div class="element-item" draggable="true" data-element="heading">
                            <i class="fas fa-heading"></i>
                            <span>T√≠tulo</span>
                        </div>
                        <div class="element-item" draggable="true" data-element="image">
                            <i class="fas fa-image"></i>
                            <span>Imagem</span>
                        </div>
                        <div class="element-item" draggable="true" data-element="button">
                            <i class="fas fa-square"></i>
                            <span>Bot√£o</span>
                        </div>
                    </div>
                </div>
                
                <div class="category-section">
                    <h6 class="category-title">üó∫Ô∏è Mapa</h6>
                    <div class="element-grid">
                        <div class="element-item" draggable="true" data-element="map">
                            <i class="fas fa-map"></i>
                            <span>Mapa</span>
                        </div>
                        <div class="element-item" draggable="true" data-element="marker">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Marcador</span>
                        </div>
                        <div class="element-item" draggable="true" data-element="route">
                            <i class="fas fa-route"></i>
                            <span>Rota</span>
                        </div>
                    </div>
                </div>
                
                <div class="category-section">
                    <h6 class="category-title">üìä M√≠dia</h6>
                    <div class="element-grid">
                        <div class="element-item" draggable="true" data-element="video">
                            <i class="fas fa-video"></i>
                            <span>V√≠deo</span>
                        </div>
                        <div class="element-item" draggable="true" data-element="gallery">
                            <i class="fas fa-images"></i>
                            <span>Galeria</span>
                        </div>
                        <div class="element-item" draggable="true" data-element="carousel">
                            <i class="fas fa-images"></i>
                            <span>Carrossel</span>
                        </div>
                    </div>
                </div>
                
                <div class="category-section">
                    <h6 class="category-title">üìã Layout</h6>
                    <div class="element-grid">
                        <div class="element-item" draggable="true" data-element="container">
                            <i class="fas fa-square-full"></i>
                            <span>Container</span>
                        </div>
                        <div class="element-item" draggable="true" data-element="row">
                            <i class="fas fa-columns"></i>
                            <span>Linha</span>
                        </div>
                        <div class="element-item" draggable="true" data-element="column">
                            <i class="fas fa-columns"></i>
                            <span>Coluna</span>
                        </div>
                        <div class="element-item" draggable="true" data-element="card">
                            <i class="fas fa-credit-card"></i>
                            <span>Card</span>
                        </div>
                    </div>
                </div>
                
                <div class="category-section">
                    <h6 class="category-title">üé® Estilo</h6>
                    <div class="element-grid">
                        <div class="element-item" draggable="true" data-element="divider">
                            <i class="fas fa-minus"></i>
                            <span>Divisor</span>
                        </div>
                        <div class="element-item" draggable="true" data-element="spacer">
                            <i class="fas fa-arrows-alt-v"></i>
                            <span>Espa√ßador</span>
                        </div>
                        <div class="element-item" draggable="true" data-element="background">
                            <i class="fas fa-palette"></i>
                            <span>Fundo</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- √Årea Principal de Edi√ß√£o -->
    <div class="main-editor">
        <div class="canvas-container">
            <div class="canvas-wrapper" id="canvas-wrapper">
                <div class="canvas" id="main-canvas">
                    <!-- √Årea de drop para elementos -->
                    <div class="drop-zone" id="drop-zone">
                        <div class="drop-zone-content">
                            <i class="fas fa-plus-circle fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">Arraste elementos aqui para come√ßar</h5>
                            <p class="text-muted">Use o painel esquerdo para adicionar elementos ao seu template</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Painel Direito - Propriedades -->
    <div class="right-panel" id="right-panel">
        <div class="panel-header">
            <h6><i class="fas fa-sliders-h"></i> Propriedades</h6>
            <button class="btn-close btn-close-sm" onclick="toggleRightPanel()"></button>
        </div>
        
        <div class="panel-content" id="properties-panel">
            <div class="no-selection">
                <i class="fas fa-mouse-pointer fa-2x text-muted mb-3"></i>
                <p class="text-muted">Selecione um elemento para editar suas propriedades</p>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Preview -->
<div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Preview do Template</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0">
                <div id="preview-content"></div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Salvar -->
<div class="modal fade" id="saveModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Salvar Template</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Nome do Template</label>
                    <input type="text" class="form-control" id="template-name" placeholder="Digite o nome do template">
                </div>
                <div class="mb-3">
                    <label class="form-label">Descri√ß√£o</label>
                    <textarea class="form-control" id="template-description" rows="3" placeholder="Descreva o template"></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Categoria</label>
                    <select class="form-select" id="template-category">
                        <option value="business">Neg√≥cios</option>
                        <option value="education">Educa√ß√£o</option>
                        <option value="tourism">Turismo</option>
                        <option value="portfolio">Portf√≥lio</option>
                        <option value="custom">Personalizado</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="confirmSave()">Salvar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Publicar -->
<div class="modal fade" id="publishModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Publicar Template</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Seu template ser√° publicado e estar√° dispon√≠vel para uso por outros usu√°rios.
                </div>
                <div class="mb-3">
                    <label class="form-label">Nome do Template</label>
                    <input type="text" class="form-control" id="publish-template-name" placeholder="Digite o nome do template">
                </div>
                <div class="mb-3">
                    <label class="form-label">Descri√ß√£o</label>
                    <textarea class="form-control" id="publish-template-description" rows="3" placeholder="Descreva o template"></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Tags</label>
                    <input type="text" class="form-control" id="publish-template-tags" placeholder="tag1, tag2, tag3">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-success" onclick="confirmPublish()">Publicar</button>
            </div>
        </div>
    </div>
</div>

<!-- Templates de Exemplo -->
<div class="templates-section" id="templates-section" style="display: none;">
    <div class="container-fluid">
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="h2 mb-1">
                            <i class="fas fa-layer-group text-primary me-2"></i>
                            Templates de Relat√≥rio Geogr√°fico
                        </h1>
                        <p class="text-muted mb-0">Escolha um template e personalize-o com seus dados e conte√∫do</p>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary" onclick="showTemplateBuilder()">
                            <i class="fas fa-magic me-2"></i>Construtor de Template
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Grid de Templates -->
        <div class="row g-4" id="templates-grid">
            <!-- Templates ser√£o carregados aqui -->
        </div>
    </div>
</div>
{% endblock %}

{% block head %}
<link href="{{ url_for('static', filename='css/template_builder.css') }}" rel="stylesheet">
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/geographic_report_templates.js') }}"></script>
<script src="{{ url_for('static', filename='js/template_builder.js') }}"></script>
{% endblock %}
