{% extends 'layout.html' %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <!-- Se√ß√£o de Boas-vindas -->
    <div class="col-lg-4 mb-4">
      <div class="text-center py-5">
        <h1 class="text-primary">Bem-vindo ao WebGIS</h1>
        <p class="lead">Plataforma completa de geoprocessamento e an√°lise espacial.</p>
        <div class="d-flex gap-2 justify-content-center mb-4">
          <a class="btn btn-primary btn-lg" href="{{ url_for('login') }}">
            <i class="fas fa-sign-in-alt me-2"></i>Entrar
          </a>
          <a class="btn btn-outline-primary btn-lg" href="{{ url_for('precos') }}">
            <i class="fas fa-tags me-2"></i>Ver Pre√ßos
          </a>
        </div>
        
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">üåê Portal da Empresa</h5>
            <p class="card-text">Se voc√™ sabe a URL do portal da sua empresa, acesse diretamente:</p>
            <code>/portal/&lt;slug&gt;</code>
            <small class="d-block text-muted mt-2">Ex.: {{ request.host_url }}portal/minha-empresa</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Se√ß√£o de Recursos -->
    <div class="col-lg-8">
      <div class="row">
        <div class="col-md-6 mb-4">
          <div class="card h-100 border-0 shadow-sm">
            <div class="card-body text-center">
              <div class="display-4 text-primary mb-3">
                <i class="fas fa-map-marked-alt"></i>
              </div>
              <h4>Mapas Interativos</h4>
              <p class="text-muted">Crie mapas profissionais com dados geogr√°ficos avan√ßados</p>
            </div>
          </div>
        </div>
        
        <div class="col-md-6 mb-4">
          <div class="card h-100 border-0 shadow-sm">
            <div class="card-body text-center">
              <div class="display-4 text-success mb-3">
                <i class="fas fa-layer-group"></i>
              </div>
              <h4>Camadas Personalizadas</h4>
              <p class="text-muted">Organize seus dados em camadas tem√°ticas e projetos</p>
            </div>
          </div>
        </div>
        
        <div class="col-md-6 mb-4">
          <div class="card h-100 border-0 shadow-sm">
            <div class="card-body text-center">
              <div class="display-4 text-info mb-3">
                <i class="fas fa-share-alt"></i>
              </div>
              <h4>Compartilhamento</h4>
              <p class="text-muted">Compartilhe mapas p√∫blicos ou privados com sua equipe</p>
            </div>
          </div>
        </div>
        
        <div class="col-md-6 mb-4">
          <div class="card h-100 border-0 shadow-sm">
            <div class="card-body text-center">
              <div class="display-4 text-warning mb-3">
                <i class="fas fa-chart-line"></i>
              </div>
              <h4>An√°lise Espacial</h4>
              <p class="text-muted">Ferramentas avan√ßadas para an√°lise e visualiza√ß√£o de dados</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- CTA para Pre√ßos -->
      <div class="card bg-gradient-primary text-white border-0 shadow-lg">
        <div class="card-body text-center py-4">
          <h3 class="mb-3">
            <i class="fas fa-calculator me-2"></i>Pre√ßos Transparentes
          </h3>
          <p class="lead mb-4">Descubra o plano ideal para sua empresa com nossa calculadora personalizada</p>
          <div class="row text-center mb-3">
             <div class="col-md-4">
               <div class="bg-white bg-opacity-10 rounded p-2">
                 <h5 class="mb-1">Starter</h5>
                 <div class="mb-1" id="home-starter-original" style="display: none;">
                   <small class="text-decoration-line-through">R$ 0,00/m√™s</small>
                 </div>
                 <h4 class="mb-0" id="home-starter-price">Carregando...</h4>
                 <small class="badge bg-success" id="home-starter-discount" style="display: none;">0% OFF</small>
               </div>
             </div>
             <div class="col-md-4">
               <div class="bg-white bg-opacity-20 rounded p-2">
                 <h5 class="mb-1">Professional</h5>
                 <div class="mb-1" id="home-professional-original" style="display: none;">
                   <small class="text-decoration-line-through">R$ 0,00/m√™s</small>
                 </div>
                 <h4 class="mb-0" id="home-professional-price">Carregando...</h4>
                 <small class="badge bg-success" id="home-professional-discount" style="display: none;">0% OFF</small>
               </div>
             </div>
             <div class="col-md-4">
               <div class="bg-white bg-opacity-10 rounded p-2">
                 <h5 class="mb-1">Enterprise</h5>
                 <div class="mb-1" id="home-enterprise-original" style="display: none;">
                   <small class="text-decoration-line-through">R$ 0,00/m√™s</small>
                 </div>
                 <h4 class="mb-0" id="home-enterprise-price">Carregando...</h4>
                 <small class="badge bg-success" id="home-enterprise-discount" style="display: none;">0% OFF</small>
               </div>
             </div>
           </div>
           <a href="{{ url_for('precos') }}" class="btn btn-light btn-lg">
             <i class="fas fa-tags me-2"></i>Ver Planos e Pre√ßos
           </a>
         </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

<!-- JavaScript para carregar pre√ßos dinamicamente -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Carregar pre√ßos dos planos dinamicamente
    loadHomePlanPrices();
    
    // Atualizar pre√ßos a cada 30 segundos
    setInterval(loadHomePlanPrices, 30000);
});

async function loadHomePlanPrices() {
    try {
        const response = await fetch('/api/pricing/plans');
        if (!response.ok) {
            throw new Error(`Erro HTTP: ${response.status}`);
        }
        
        const data = await response.json();
        if (data.success) {
            updateHomePlanPrices(data.plans);
        } else {
            console.error('Erro ao carregar pre√ßos:', data.error);
        }
    } catch (error) {
        console.error('Erro ao carregar pre√ßos dos planos:', error);
    }
}

function updateHomePlanPrices(plans) {
    // Atualizar pre√ßos dos planos na home
    if (plans.starter) {
        document.getElementById('home-starter-price').textContent = `${formatarMoeda(plans.starter.final_price)}/m√™s`;
        
        if (plans.starter.discount > 0) {
            document.getElementById('home-starter-original').querySelector('small').textContent = `${formatarMoeda(plans.starter.original_price)}/m√™s`;
            document.getElementById('home-starter-original').style.display = 'block';
            document.getElementById('home-starter-discount').querySelector('span').textContent = `${plans.starter.discount.toFixed(1)}% de desconto`;
            document.getElementById('home-starter-discount').style.display = 'block';
        }
    }
    
    if (plans.professional) {
        document.getElementById('home-professional-price').textContent = `${formatarMoeda(plans.professional.final_price)}/m√™s`;
        
        if (plans.professional.discount > 0) {
            document.getElementById('home-professional-original').querySelector('small').textContent = `${formatarMoeda(plans.professional.original_price)}/m√™s`;
            document.getElementById('home-professional-original').style.display = 'block';
            document.getElementById('home-professional-discount').querySelector('span').textContent = `${plans.professional.discount.toFixed(1)}% de desconto`;
            document.getElementById('home-professional-discount').style.display = 'block';
        }
    }
    
    if (plans.enterprise) {
        document.getElementById('home-enterprise-price').textContent = `${formatarMoeda(plans.enterprise.final_price)}/m√™s`;
        
        if (plans.enterprise.discount > 0) {
            document.getElementById('home-enterprise-original').querySelector('small').textContent = `${formatarMoeda(plans.enterprise.original_price)}/m√™s`;
            document.getElementById('home-enterprise-original').style.display = 'block';
            document.getElementById('home-enterprise-discount').querySelector('span').textContent = `${plans.enterprise.discount.toFixed(1)}% de desconto`;
            document.getElementById('home-enterprise-discount').style.display = 'block';
        }
    }
}
</script>

