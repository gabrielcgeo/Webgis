{% extends 'layout.html' %}
{% block content %}
<h2>{{ shared_map.name }}</h2>
<div id="map" style="height: 75vh;"></div>
{% endblock %}
{% block scripts %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([-14.2, -51.9], 4);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 19}).addTo(map);
  async function load() {
    const layers = await (await fetch(`{{ url_for('public_api_layers', public_id=shared_map.public_id) }}`)).json();
    // Exemplo simples: carrega apenas GeoJSON quando filename referenciar dados locais
    for (const l of layers) {
      try {
        const gj = await (await fetch(`{{ url_for('public_api_layer_data', filename='__f__') }}`.replace('__f__', l.filename))).json();
        L.geoJSON(gj).addTo(map);
      } catch(e) {}
    }
  }
  load();
</script>
{% endblock %}

